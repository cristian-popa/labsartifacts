{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Sid": "StudentTasks",
            "Effect": "Allow",
            "Action": [
                "ec2:*",
                "s3:*",
                "sns:*",
                "lambda:*",
                "sqs:*",
                "ssm:put*",
                "cloudformation:*",
                "aws-marketplace:*",
                "cloudwatch:*",
                "logs:*",
                "eks:*",
                "ecr:*",
                "autoscaling:*",
                "cloudshell:*",
                "cloudtrail:*"
            ],
            "Resource": "*"
        },
        {
            "Sid": "AllowCreateRole",
            "Effect": "Allow",
            "Action": [
                "iam:CreateRole",
                "iam:CreateInstanceProfile",
                "iam:PassRole",
                "iam:CreatePolicy",
                "iam:AttachRolePolicy",
                "iam:PutRolePolicy",
                "iam:AddRoleToInstanceProfile",
                "iam:List*",
                "iam:Get*",
                "iam:TagRole",
                "iam:GetRole"
            ],
            "Resource": "*"
        },
        {
            "Effect": "Allow",
            "Action": [
                "iam:CreateServiceLinkedRole"
            ],
            "Resource": "*",
            "Condition": {
                "StringEquals": {
                    "iam:AWSServiceName": [
                        "eks.amazonaws.com",
                        "eks-nodegroup.amazonaws.com",
                        "eks-fargate.amazonaws.com"
                    ]
                }
            }
        },
        {
            "Sid": "limitedSize",
            "Effect": "Deny",
            "Action": "ec2:RunInstances",
            "Resource": "arn:aws:ec2:*:*:instance/*",
            "Condition": {
                "ForAnyValue:StringNotLike": {
                    "ec2:InstanceType": [
                        "t2.micro",
                        "t2.small",
                        "t3.micro"
                    ]
                }
            }
        },
        {
            "Sid": "WizConnectorDeploy",
            "Effect": "Allow",
            "Action": [
                "ec2:*",
                "acm:Describe*",
                "acm:List*",
                "acm:Get*",
                "apigateway:GET",
                "appstream:Describe*",
                "appstream:Get*",
                "appstream:List*",
                "athena:Get*",
                "athena:List*",
                "autoscaling:Describe*",
                "autoscaling:Describe*",
                "batch:Describe*",
                "batch:List*",
                "cloudformation:Describe*",
                "cloudformation:Get*",
                "cloudformation:List*",
                "cloudformation:CreateUploadBucket",
                "cloudfront:Get*",
                "cloudfront:List*",
                "cloudhsm:Describe*",
                "cloudhsm:Get*",
                "cloudhsm:List*",
                "cloudsearch:Describe*",
                "cloudsearch:Search*",
                "cloudtrail:Describe*",
                "cloudtrail:Get*",
                "cloudtrail:LookupEvents",
                "cloudwatch:Describe*",
                "cloudwatch:Get*",
                "cloudwatch:List*",
                "events:Describe*",
                "events:List*",
                "logs:Describe*",
                "logs:Get*",
                "logs:List*",
                "logs:DescribeLogGroups*",
                "cloudwatch:GetMetricData*",
                "codebuild:BatchGet*",
                "codebuild:List*",
                "codecommit:BatchGet*",
                "codecommit:Get*",
                "codecommit:List*",
                "codedeploy:BatchGet*",
                "codedeploy:Get*",
                "codedeploy:List*",
                "codepipeline:Get*",
                "codepipeline:List*",
                "cognito-identity:Describe*",
                "cognito-identity:Get*",
                "cognito-identity:List*",
                "cognito-idp:AdminGet*",
                "cognito-idp:List*",
                "config:BatchGet*",
                "config:Describe*",
                "config:Get*",
                "config:List*",
                "datapipeline:Describe*",
                "datapipeline:Get*",
                "datapipeline:List*",
                "devicefarm:Get*",
                "devicefarm:List*",
                "directconnect:Describe*",
                "directconnect:List*",
                "ds:Describe*",
                "ds:Get*",
                "ds:List*",
                "dynamodb:BatchGet*",
                "dynamodb:BatchWrite*",
                "dynamodb:Describe*",
                "dynamodb:Get*",
                "dynamodb:List*",
                "dynamodb:Query",
                "dynamodb:Scan",
                "ec2:Describe*",
                "ec2:Get*",
                "ec2:Report*",
                "elasticbeanstalk:Check*",
                "elasticbeanstalk:Describe*",
                "elasticbeanstalk:List*",
                "ecr:BatchCheck*",
                "ecr:BatchGet*",
                "ecr:Describe*",
                "ecr:Get*",
                "ecr:List*",
                "ecs:Describe*",
                "ecs:List*",
                "ecs:DescribeServices",
                "ecs:DescribeTaskDefinition",
                "ecs:DescribeTasks",
                "ecs:ListAccountSettings",
                "ecs:ListClusters",
                "ecs:ListContainerInstances",
                "ecs:ListServices",
                "ecs:ListTaskDefinitions",
                "ecs:ListTasks",
                "eks:*",
                "elasticfilesystem:Describe*",
                "elasticfilesystem:List*",
                "elasticloadbalancing:Describe*",
                "elasticmapreduce:Describe*",
                "elasticmapreduce:Get*",
                "elasticmapreduce:List*",
                "es:Describe*",
                "es:Get*",
                "es:List*",
                "glacier:Describe*",
                "glacier:Get*",
                "glacier:List*",
                "iam:CreateInstanceProfile",
                "iam:CreateRole",
                "iam:DetachRolePolicy",
                "iam:Generate*",
                "iam:Get*",
                "iam:List*",
                "iam:Simulate*",
                "iam:GetAccountSummary",
                "iam:CreateRole",
                "iam:AddRoleToInstanceProfile",
                "iam:PassRole",
                "iam:CreatePolicy",
                "iam:AttachRolePolicy",
                "iam:PutRolePolicy",
                "inspector:Describe*",
                "inspector:Get*",
                "inspector:List*",
                "kinesis:Describe*",
                "kinesis:Get*",
                "kinesis:List*",
                "kms:Describe*",
                "kms:Get*",
                "kms:List*",
                "kms:CreateKey",
                "lambda:Get*",
                "lambda:List*",
                "lightsail:Get*",
                "mq:Describe*",
                "mq:List*",
                "rds:Describe*",
                "rds:Modify*",
                "rds:List*",
                "redshift:Describe*",
                "redshift:Get*",
                "redshift:List*",
                "route53:Get*",
                "route53:List*",
                "sns:*",
                "s3:Get*",
                "s3:List*",
                "sagemaker:Describe*",
                "sagemaker:Get*",
                "ses:Get*",
                "ses:List*",
                "sqs:Get*",
                "sqs:List*",
                "swf:Count*",
                "swf:Describe*",
                "swf:Get*",
                "swf:List*",
                "ssm:Describe*",
                "ssm:Get*",
                "ssm:List*",
                "waf:Get*",
                "waf:List*",
                "workspaces:Describe*",
                "workspaces:List*",
                "acm:Describe*",
                "acm:Get*",
                "acm:List*",
                "cloudtrail:Describe*",
                "cloudtrail:Get*",
                "cloudtrail:List*",
                "cloudwatch:Describe*",
                "cloudwatch:Get*",
                "cloudwatch:List*",
                "codebuild:BatchGet*",
                "codebuild:Describe*",
                "codebuild:Get*",
                "codebuild:List*",
                "codecommit:BatchGet*",
                "codecommit:Describe*",
                "codecommit:Get*",
                "codecommit:List*",
                "codedeploy:BatchGet*",
                "codedeploy:Get*",
                "codedeploy:List*",
                "codepipeline:List*",
                "codepipeline:Get*",
                "config:BatchGet*",
                "config:Describe*",
                "config:Get*",
                "config:List*",
                "datapipeline:Describe*",
                "datapipeline:Get*",
                "datapipeline:List*",
                "directconnect:Describe*",
                "directconnect:List*",
                "gamelift:Describe*",
                "gamelift:Get*",
                "gamelift:List*",
                "guardduty:Describe*",
                "guardduty:Get*",
                "guardduty:List*",
                "iot:Describe*",
                "iot:Get*",
                "iot:List*",
                "iotanalytics:Describe*",
                "iotanalytics:Get*",
                "iotanalytics:List*",
                "kinesisanalytics:Describe*",
                "kinesisanalytics:Get*",
                "kinesisanalytics:List*",
                "medialive:Describe*",
                "medialive:List*",
                "mediapackage:Describe*",
                "rds:AddTagsToResource",
                "kms:DescribeKey",
                "kms:CreateGrant",
                "kms:Decrypt",
                "kms:GenerateDataKey",
                "secretsmanager:CreateSecret",
                "secretsmanager:TagResource"
            ],
            "Resource": "*",
            "Condition": {
                "Bool": {
                    "aws:ViaAWSService": "true"
                },
                "StringLike": {
                    "cloudformation:TemplateURL": [
                        "https://wizio-public.s3.amazonaws.com/deployment*",
                        "https://clwizlabs.s3.amazonaws.com/",
                        "https://cloudlabs-clwizlabs-43ivw811mgoc.s3.amazonaws.com/"
                    ]
                }
            }
        },
        {
            "Sid": "EksAllAccess",
            "Effect": "Allow",
            "Action": "eks:*",
            "Resource": "*"
        },
        {
            "Action": [
                "ssm:GetParameter",
                "ssm:GetParameters"
            ],
            "Resource": [
                "arn:aws:ssm:*:*:parameter/aws/*",
                "arn:aws:ssm:*::parameter/aws/*"
            ],
            "Effect": "Allow"
        },
        {
             "Action": [
               "kms:CreateGrant",
               "kms:DescribeKey"
             ],
             "Resource": "*",
             "Effect": "Allow"
        },
        {
             "Action": [
               "logs:PutRetentionPolicy"
             ],
             "Resource": "*",
             "Effect": "Allow"
        },        
        {
            "Sid": "DenyCreateRole",
            "Effect": "Deny",
            "Action": [
                "iam:Create*"
            ],
            "Resource": "*",
            "Condition": {
                "Bool": {
                    "aws:ViaAWSService": "false"
                }
            }
        }
    ]
}